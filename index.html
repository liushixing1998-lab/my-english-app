<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>影子跟读H5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary-color: #52c41a; --text-main: #333; --text-sub: #999; --bg-gray: #f7f8fa; }
        
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--bg-gray); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* 1. 顶部视频区 */
        .video-fixed { width: 100%; background: #000; position: sticky; top: 0; z-index: 100; }
        video { width: 100%; aspect-ratio: 16 / 9; display: block; }

        /* 2. 模式切换 Tab */
        .mode-tabs { display: flex; background: #fff; border-bottom: 1px solid #eee; }
        .tab-item { flex: 1; text-align: center; padding: 15px 0; font-size: 15px; color: var(--text-sub); cursor: pointer; position: relative; }
        .tab-item.active { color: var(--text-main); font-weight: bold; }
        .tab-item.active::after { content: ""; position: absolute; bottom: 0; left: 25%; width: 50%; height: 3px; background: var(--primary-color); border-radius: 2px; }

        /* 3. 内容显示区 */
        .content-container { flex: 1; overflow-y: auto; padding: 10px; padding-bottom: 100px; -webkit-overflow-scrolling: touch; }
        
        /* 字幕卡片样式 */
        .subtitle-card { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 10px; border: 2px solid transparent; transition: 0.3s; }
        .subtitle-card.highlight { border-color: var(--primary-color); background: #f6ffed; }
        .time-tag { font-size: 11px; color: #ccc; margin-bottom: 5px; }
        .en-text { font-size: 16px; color: var(--text-main); margin-bottom: 8px; line-height: 1.4; }
        /* 重点词样式 */
        .keyword { color: var(--primary-color); font-weight: bold; border-bottom: 1px solid var(--primary-color); cursor: pointer; }
        .cn-text { font-size: 14px; color: var(--text-sub); }

        /* 4. 底部播放控制栏 */
        .control-bar { position: fixed; bottom: 0; width: 100%; height: 80px; background: #fff; border-top: 1px solid #eee; display: flex; align-items: center; justify-content: space-around; padding-bottom: env(safe-area-inset-bottom); }
        .ctrl-btn { display: flex; flex-direction: column; align-items: center; font-size: 11px; color: #666; cursor: pointer; }
        .ctrl-btn i { font-size: 20px; margin-bottom: 4px; }
        .play-main { width: 50px; height: 50px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 22px; box-shadow: 0 4px 10px rgba(82,196,26,0.3); }

        /* 隐藏其他模式的内容 */
        .mode-section { display: none; }
        .mode-section.show { display: block; }
    </style>
</head>
<body>

    <div class="video-fixed">
        <video id="mainVideo" src="https://bbbbbb11111.oss-cn-beijing.aliyuncs.com/lesson1.mp4" playsinline controls></video>
    </div>

    <div class="mode-tabs">
        <div class="tab-item active" onclick="changeMode(0)">字幕</div>
        <div class="tab-item" onclick="changeMode(1)">跟读</div>
        <div class="tab-item" onclick="changeMode(2)">听写</div>
        <div class="tab-item" onclick="changeMode(3)">词卡</div>
    </div>

    <div class="content-container">
        <div id="section-0" class="mode-section show">
            <div id="subtitle-list"></div>
        </div>
        
        <div id="section-1" class="mode-section" style="text-align: center; padding-top: 50px; color: #ccc;">跟读练习功能开发中...</div>
        <div id="section-2" class="mode-section" style="text-align: center; padding-top: 50px; color: #ccc;">听写模式开发中...</div>
        <div id="section-3" class="mode-section" style="text-align: center; padding-top: 50px; color: #ccc;">核心词卡开发中...</div>
    </div>

    <div class="control-bar">
        <div class="ctrl-btn"><i class="fa-solid fa-language"></i><span>双语</span></div>
        <div class="ctrl-btn" onclick="changeSpeed()"><i class="fa-solid fa-gauge-high"></i><span id="speedTxt">1.0x</span></div>
        <div class="play-main" onclick="togglePlay()"><i id="playIcon" class="fa-solid fa-play"></i></div>
        <div class="ctrl-btn"><i class="fa-solid fa-rotate-right"></i><span>单句循环</span></div>
        <div class="ctrl-btn"><i class="fa-solid fa-book-open"></i><span>精读</span></div>
    </div>

<script>
    // 1. 获取网页元素
    const video = document.getElementById('mainVideo');
    const subtitleList = document.getElementById('subtitle-list');
    const playIcon = document.getElementById('playIcon');
    const speedTxt = document.getElementById('speedTxt');

    // 2. 准备数据：这里模拟你的 Excel 数据
    // 注意：en 中的 [[word]] 用来标记重点词卡
    // 自动从文件夹读取 JSON 数据
    fetch('assets/subtitle/lesson1.json')
        .then(response => response.json())
        .then(data => {
            subtitleData = data; // 把读取到的数据给变量
            renderSubtitles();   // 开始渲染
        })
        .catch(err => console.error("加载字幕失败:", err));

    // 3. 渲染字幕到页面
    function renderSubtitles() {
        subtitleList.innerHTML = '';
        subtitleData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'subtitle-card';
            card.id = `line-${index}`;
            
            // 处理重点词高亮逻辑
            const processedEn = item.en.replace(/\[\[(.*?)\]\]/g, '<span class="keyword">$1</span>');
            
            card.innerHTML = `
                <div class="time-tag">0:${item.start < 10 ? '0'+item.start : item.start}</div>
                <div class="en-text">${processedEn}</div>
                <div class="cn-text">${item.cn}</div>
            `;
            
            // 点击跳转功能
            card.onclick = () => {
                video.currentTime = item.start;
                video.play();
            };
            subtitleList.appendChild(card);
        });
    }

    // 4. 视频播放实时高亮逻辑
    video.ontimeupdate = () => {
        const now = video.currentTime;
        subtitleData.forEach((item, index) => {
            const card = document.getElementById(`line-${index}`);
            if (now >= item.start && now < item.end) {
                if (!card.classList.contains('highlight')) {
                    // 移除其他高亮
                    document.querySelectorAll('.subtitle-card').forEach(el => el.classList.remove('highlight'));
                    // 添加当前高亮
                    card.classList.add('highlight');
                    // 自动滚动到中间
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    };

    // 5. 底部按钮功能实现
    function togglePlay() {
        if (video.paused) {
            video.play();
            playIcon.className = "fa-solid fa-pause";
        } else {
            video.pause();
            playIcon.className = "fa-solid fa-play";
        }
    }

    let speeds = [1.0, 0.8, 1.2, 1.5];
    let speedIdx = 0;
    function changeSpeed() {
        speedIdx = (speedIdx + 1) % speeds.length;
        video.playbackRate = speeds[speedIdx];
        speedTxt.innerText = speeds[speedIdx] + 'x';
    }

    function changeMode(index) {
        // 切换Tab样式
        document.querySelectorAll('.tab-item').forEach((tab, i) => {
            i === index ? tab.classList.add('active') : tab.classList.remove('active');
        });
        // 切换内容显示
        document.querySelectorAll('.mode-section').forEach((sec, i) => {
            i === index ? sec.classList.add('show') : sec.classList.remove('show');
        });
    }

    // 初始化运行
    renderSubtitles();
</script>
</body>

</html>
